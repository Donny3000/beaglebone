<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Xenomai API: include/nucleus/vfile.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>include/nucleus/vfile.h</h1>  </div>
</div>
<div class="contents">
<a href="vfile_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00024"></a>00024 <span class="preprocessor">#ifndef _XENO_NUCLEUS_VFILE_H</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#define _XENO_NUCLEUS_VFILE_H</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>
<a name="l00027"></a>00027 <span class="preprocessor">#if defined(CONFIG_XENO_OPT_VFILE) || defined(DOXYGEN_CPP)</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;linux/proc_fs.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;linux/seq_file.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;nucleus/types.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">struct </span>xnvfile_directory;
<a name="l00037"></a>00037 <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a>;
<a name="l00038"></a>00038 <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a>;
<a name="l00039"></a>00039 <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a>;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="keyword">struct </span>xnvfile {
<a name="l00042"></a>00042         <span class="keyword">struct </span>proc_dir_entry *pde;
<a name="l00043"></a>00043         <span class="keyword">struct </span>file *file;
<a name="l00044"></a>00044         <span class="keyword">struct </span>xnvfile_directory *parent;
<a name="l00045"></a>00045         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> *lockops;
<a name="l00046"></a>00046         <span class="keywordtype">int</span> refcnt;
<a name="l00047"></a>00047         <span class="keywordtype">void</span> *<span class="keyword">private</span>;
<a name="l00048"></a>00048 };
<a name="l00049"></a>00049 
<a name="l00058"></a><a class="code" href="structxnvfile__lock__ops.html">00058</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> {
<a name="l00071"></a><a class="code" href="structxnvfile__lock__ops.html#a270b2531bc11744d1bb66c6d251c2b81">00071</a>         int (*<span class="keyword">get</span>)(<span class="keyword">struct </span>xnvfile *vfile);
<a name="l00079"></a><a class="code" href="structxnvfile__lock__ops.html#a761e2f9fbf035d43c84621082d57b110">00079</a>         void (*<a class="code" href="structxnvfile__lock__ops.html#a761e2f9fbf035d43c84621082d57b110">put</a>)(<span class="keyword">struct </span>xnvfile *vfile);
<a name="l00080"></a>00080 };
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">/*</span>
<a name="l00083"></a>00083 <span class="comment"> * XXX: struct semaphore is legacy for mutual exclusion, but supported</span>
<a name="l00084"></a>00084 <span class="comment"> * on both 2.4 and 2.6 kernels. Will be changed to mutex when 2.4</span>
<a name="l00085"></a>00085 <span class="comment"> * support is dropped from Xenomai.</span>
<a name="l00086"></a>00086 <span class="comment"> */</span>
<a name="l00087"></a>00087 <span class="keyword">struct </span>xnvfile_hostlock_class {
<a name="l00088"></a>00088         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> ops;
<a name="l00089"></a>00089         <span class="keyword">struct </span>semaphore sem;
<a name="l00090"></a>00090 };
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="keyword">struct </span>xnvfile_nklock_class {
<a name="l00093"></a>00093         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> ops;
<a name="l00094"></a>00094         spl_t s;
<a name="l00095"></a>00095 };
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="keyword">struct </span>xnvfile_input {
<a name="l00098"></a>00098         <span class="keyword">const</span> <span class="keywordtype">char</span> __user *u_buf;
<a name="l00099"></a>00099         <span class="keywordtype">size_t</span> size;
<a name="l00100"></a>00100         <span class="keyword">struct </span>xnvfile *vfile;
<a name="l00101"></a>00101 };
<a name="l00102"></a>00102 
<a name="l00112"></a><a class="code" href="structxnvfile__regular__ops.html">00112</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__ops.html" title="Regular vfile operation descriptor.">xnvfile_regular_ops</a> {
<a name="l00130"></a><a class="code" href="structxnvfile__regular__ops.html#a054ed8bb69da0a0c6e3c4f5d239b0dcf">00130</a>         int (*<a class="code" href="structxnvfile__regular__ops.html#a054ed8bb69da0a0c6e3c4f5d239b0dcf">rewind</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> *it);
<a name="l00163"></a><a class="code" href="structxnvfile__regular__ops.html#aaf7b735bddab35a238045e3d2b7e2484">00163</a>         <span class="keywordtype">void</span> *(*begin)(<span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> *it);
<a name="l00190"></a><a class="code" href="structxnvfile__regular__ops.html#aeb55d4c32cc11813068a0fc055996462">00190</a>         <span class="keywordtype">void</span> *(*next)(<span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> *it);
<a name="l00199"></a><a class="code" href="structxnvfile__regular__ops.html#a29ba8b1f5ff72e70411c977397b91877">00199</a>         void (*<a class="code" href="structxnvfile__regular__ops.html#a29ba8b1f5ff72e70411c977397b91877">end</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> *it);
<a name="l00228"></a><a class="code" href="structxnvfile__regular__ops.html#ac1d48ccaa785342eaa4c80360a560c70">00228</a>         int (*<a class="code" href="structxnvfile__regular__ops.html#ac1d48ccaa785342eaa4c80360a560c70">show</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> *it, <span class="keywordtype">void</span> *data);
<a name="l00257"></a><a class="code" href="structxnvfile__regular__ops.html#ad2b85a790c9a10c62a96f7bd5d3bde6f">00257</a>         ssize_t (*<a class="code" href="structxnvfile__regular__ops.html#ad2b85a790c9a10c62a96f7bd5d3bde6f">store</a>)(<span class="keyword">struct </span>xnvfile_input *input);
<a name="l00258"></a>00258 };
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="keyword">struct </span>xnvfile_regular {
<a name="l00261"></a>00261         <span class="keyword">struct </span>xnvfile entry;
<a name="l00262"></a>00262         <span class="keywordtype">size_t</span> privsz;
<a name="l00263"></a>00263         <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__ops.html" title="Regular vfile operation descriptor.">xnvfile_regular_ops</a> *ops;
<a name="l00264"></a>00264 };
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="keyword">struct </span>xnvfile_regular_template {
<a name="l00267"></a>00267         <span class="keywordtype">size_t</span> privsz;
<a name="l00268"></a>00268         <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__ops.html" title="Regular vfile operation descriptor.">xnvfile_regular_ops</a> *ops;
<a name="l00269"></a>00269         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> *lockops;
<a name="l00270"></a>00270 };
<a name="l00271"></a>00271 
<a name="l00278"></a><a class="code" href="structxnvfile__regular__iterator.html">00278</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> {
<a name="l00280"></a><a class="code" href="structxnvfile__regular__iterator.html#a95c5a521f5bceaff6f76526e854afddf">00280</a>         loff_t <a class="code" href="structxnvfile__regular__iterator.html#a95c5a521f5bceaff6f76526e854afddf" title="Current record position while iterating.">pos</a>;
<a name="l00282"></a><a class="code" href="structxnvfile__regular__iterator.html#a5ecb6c8a77f673f7dfad6befe0951a72">00282</a>         <span class="keyword">struct </span>seq_file *<a class="code" href="structxnvfile__regular__iterator.html#a5ecb6c8a77f673f7dfad6befe0951a72" title="Backlink to the host sequential file supporting the vfile.">seq</a>;
<a name="l00284"></a><a class="code" href="structxnvfile__regular__iterator.html#ad2e13d0cd8b63e0cde6e412be74c5346">00284</a>         <span class="keyword">struct </span>xnvfile_regular *<a class="code" href="structxnvfile__regular__iterator.html#ad2e13d0cd8b63e0cde6e412be74c5346" title="Backlink to the vfile being read.">vfile</a>;
<a name="l00289"></a><a class="code" href="structxnvfile__regular__iterator.html#abd62397205b2b7e17b63830474036ec7">00289</a>         <span class="keywordtype">char</span> <span class="keyword">private</span>[0];
<a name="l00290"></a>00290 };
<a name="l00291"></a>00291 
<a name="l00302"></a><a class="code" href="structxnvfile__snapshot__ops.html">00302</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__ops.html" title="Snapshot vfile operation descriptor.">xnvfile_snapshot_ops</a> {
<a name="l00343"></a><a class="code" href="structxnvfile__snapshot__ops.html#a2bb1150c2a0f60c6eb979781cbc451c1">00343</a>         int (*<a class="code" href="structxnvfile__snapshot__ops.html#a2bb1150c2a0f60c6eb979781cbc451c1">rewind</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it);
<a name="l00371"></a><a class="code" href="structxnvfile__snapshot__ops.html#a43f7c2737ab6ac530041ba0ede25684c">00371</a>         <span class="keywordtype">void</span> *(*begin)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it);
<a name="l00389"></a><a class="code" href="structxnvfile__snapshot__ops.html#ae32a9a16730fa80bfb420111832750e2">00389</a>         void (*<a class="code" href="structxnvfile__snapshot__ops.html#ae32a9a16730fa80bfb420111832750e2">end</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it, <span class="keywordtype">void</span> *buf);
<a name="l00422"></a><a class="code" href="structxnvfile__snapshot__ops.html#a37a216b44ddfa5c895b7de05da0acd10">00422</a>         int (*<a class="code" href="structxnvfile__snapshot__ops.html#a37a216b44ddfa5c895b7de05da0acd10">next</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it, <span class="keywordtype">void</span> *data);
<a name="l00451"></a><a class="code" href="structxnvfile__snapshot__ops.html#aebfdb0fda48d23b475d93d8945412ab6">00451</a>         int (*<a class="code" href="structxnvfile__snapshot__ops.html#aebfdb0fda48d23b475d93d8945412ab6">show</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it, <span class="keywordtype">void</span> *data);
<a name="l00481"></a><a class="code" href="structxnvfile__snapshot__ops.html#a0a509977acecc8bee5c00dabbfcc56d5">00481</a>         ssize_t (*<a class="code" href="structxnvfile__snapshot__ops.html#a0a509977acecc8bee5c00dabbfcc56d5">store</a>)(<span class="keyword">struct </span>xnvfile_input *input);
<a name="l00482"></a>00482 };
<a name="l00483"></a>00483 
<a name="l00491"></a><a class="code" href="structxnvfile__rev__tag.html">00491</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__rev__tag.html" title="Snapshot revision tag.">xnvfile_rev_tag</a> {
<a name="l00493"></a><a class="code" href="structxnvfile__rev__tag.html#aa15b64f33679db24160d3c893268437e">00493</a>         <span class="keywordtype">int</span> <a class="code" href="structxnvfile__rev__tag.html#aa15b64f33679db24160d3c893268437e" title="Current revision number.">rev</a>;
<a name="l00494"></a>00494 };
<a name="l00495"></a>00495 
<a name="l00496"></a>00496 <span class="keyword">struct </span>xnvfile_snapshot_template {
<a name="l00497"></a>00497         <span class="keywordtype">size_t</span> privsz;
<a name="l00498"></a>00498         <span class="keywordtype">size_t</span> datasz;
<a name="l00499"></a>00499         <span class="keyword">struct </span><a class="code" href="structxnvfile__rev__tag.html" title="Snapshot revision tag.">xnvfile_rev_tag</a> *tag;
<a name="l00500"></a>00500         <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__ops.html" title="Snapshot vfile operation descriptor.">xnvfile_snapshot_ops</a> *ops;
<a name="l00501"></a>00501         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> *lockops;
<a name="l00502"></a>00502 };
<a name="l00503"></a>00503 
<a name="l00515"></a><a class="code" href="structxnvfile__snapshot.html">00515</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> {
<a name="l00516"></a>00516         <span class="keyword">struct </span>xnvfile entry;
<a name="l00517"></a>00517         <span class="keywordtype">size_t</span> privsz;
<a name="l00518"></a>00518         <span class="keywordtype">size_t</span> datasz;
<a name="l00519"></a>00519         <span class="keyword">struct </span><a class="code" href="structxnvfile__rev__tag.html" title="Snapshot revision tag.">xnvfile_rev_tag</a> *tag;
<a name="l00520"></a>00520         <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__ops.html" title="Snapshot vfile operation descriptor.">xnvfile_snapshot_ops</a> *ops;
<a name="l00521"></a>00521 };
<a name="l00522"></a>00522 
<a name="l00529"></a><a class="code" href="structxnvfile__snapshot__iterator.html">00529</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> {
<a name="l00531"></a><a class="code" href="structxnvfile__snapshot__iterator.html#a62573366edd906816759fbdd16930522">00531</a>         <span class="keywordtype">int</span> <a class="code" href="structxnvfile__snapshot__iterator.html#a62573366edd906816759fbdd16930522" title="Number of collected records.">nrdata</a>;
<a name="l00533"></a><a class="code" href="structxnvfile__snapshot__iterator.html#ab3d26fd9ee1e14af1e5d345f589c2f3c">00533</a>         caddr_t <a class="code" href="structxnvfile__snapshot__iterator.html#ab3d26fd9ee1e14af1e5d345f589c2f3c" title="Address of record buffer.">databuf</a>;
<a name="l00535"></a><a class="code" href="structxnvfile__snapshot__iterator.html#a84d702d0ea1489dca8b4e86e06a856a0">00535</a>         <span class="keyword">struct </span>seq_file *<a class="code" href="structxnvfile__snapshot__iterator.html#a84d702d0ea1489dca8b4e86e06a856a0" title="Backlink to the host sequential file supporting the vfile.">seq</a>;
<a name="l00537"></a><a class="code" href="structxnvfile__snapshot__iterator.html#a3fb6b2e509206595af45a84926479b5f">00537</a>         <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> *<a class="code" href="structxnvfile__snapshot__iterator.html#a3fb6b2e509206595af45a84926479b5f" title="Backlink to the vfile being read.">vfile</a>;
<a name="l00539"></a><a class="code" href="structxnvfile__snapshot__iterator.html#a0c4b28f5a183309699984d859dca9dca">00539</a>         void (*<a class="code" href="structxnvfile__snapshot__iterator.html#a0c4b28f5a183309699984d859dca9dca" title="Buffer release handler.">endfn</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it, <span class="keywordtype">void</span> *buf);
<a name="l00544"></a><a class="code" href="structxnvfile__snapshot__iterator.html#a7b01ca175907f4159dfb5201be85df0a">00544</a>         <span class="keywordtype">char</span> <span class="keyword">private</span>[0];
<a name="l00545"></a>00545 };
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="keyword">struct </span>xnvfile_directory {
<a name="l00548"></a>00548         <span class="keyword">struct </span>xnvfile entry;
<a name="l00549"></a>00549 };
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 <span class="keyword">struct </span>xnvfile_link {
<a name="l00552"></a>00552         <span class="keyword">struct </span>xnvfile entry;
<a name="l00553"></a>00553 };
<a name="l00554"></a>00554 
<a name="l00555"></a>00555 <span class="comment">/* vfile.begin()=&gt; */</span>
<a name="l00556"></a>00556 <span class="preprocessor">#define VFILE_SEQ_EMPTY                 ((void *)-1)</span>
<a name="l00557"></a>00557 <span class="preprocessor"></span><span class="comment">/* =&gt;vfile.show() */</span>
<a name="l00558"></a>00558 <span class="preprocessor">#define VFILE_SEQ_START                 SEQ_START_TOKEN</span>
<a name="l00559"></a>00559 <span class="preprocessor"></span><span class="comment">/* vfile.next/show()=&gt; */</span>
<a name="l00560"></a>00560 <span class="preprocessor">#define VFILE_SEQ_SKIP                  2</span>
<a name="l00561"></a>00561 <span class="preprocessor"></span>
<a name="l00562"></a>00562 <span class="preprocessor">#define xnvfile_printf(it, args...)     seq_printf((it)-&gt;seq, ##args)</span>
<a name="l00563"></a>00563 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_write(it, data, len)    seq_write((it)-&gt;seq, (data),(len))</span>
<a name="l00564"></a>00564 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_puts(it, s)             seq_puts((it)-&gt;seq, (s))</span>
<a name="l00565"></a>00565 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_putc(it, c)             seq_putc((it)-&gt;seq, (c))</span>
<a name="l00566"></a>00566 <span class="preprocessor"></span>
<a name="l00567"></a>00567 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> xnvfile_touch_tag(<span class="keyword">struct</span> <a class="code" href="structxnvfile__rev__tag.html" title="Snapshot revision tag.">xnvfile_rev_tag</a> *tag)
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569         tag-&gt;<a class="code" href="structxnvfile__rev__tag.html#aa15b64f33679db24160d3c893268437e" title="Current revision number.">rev</a>++;
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> xnvfile_touch(<span class="keyword">struct</span> <a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> *vfile)
<a name="l00573"></a>00573 {
<a name="l00574"></a>00574         xnvfile_touch_tag(vfile-&gt;tag);
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> xnvfile_reg_p(<span class="keyword">struct</span> xnvfile *entry)
<a name="l00578"></a>00578 {
<a name="l00579"></a>00579         <span class="keywordflow">return</span> S_ISREG(entry-&gt;pde-&gt;mode);
<a name="l00580"></a>00580 }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> xnvfile_dir_p(<span class="keyword">struct</span> xnvfile *entry)
<a name="l00583"></a>00583 {
<a name="l00584"></a>00584         <span class="keywordflow">return</span> S_ISDIR(entry-&gt;pde-&gt;mode);
<a name="l00585"></a>00585 }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> xnvfile_link_p(<span class="keyword">struct</span> xnvfile *entry)
<a name="l00588"></a>00588 {
<a name="l00589"></a>00589         <span class="keywordflow">return</span> S_ISLNK(entry-&gt;pde-&gt;mode);
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 <span class="preprocessor">#define xnvfile_noentry                 \</span>
<a name="l00593"></a>00593 <span class="preprocessor">        {                               \</span>
<a name="l00594"></a>00594 <span class="preprocessor">                .pde = NULL,            \</span>
<a name="l00595"></a>00595 <span class="preprocessor">                .parent = NULL,         \</span>
<a name="l00596"></a>00596 <span class="preprocessor">                .private = NULL,        \</span>
<a name="l00597"></a>00597 <span class="preprocessor">                .file = NULL,           \</span>
<a name="l00598"></a>00598 <span class="preprocessor">                .refcnt = 0,            \</span>
<a name="l00599"></a>00599 <span class="preprocessor">        }</span>
<a name="l00600"></a>00600 <span class="preprocessor"></span>
<a name="l00601"></a>00601 <span class="preprocessor">#define xnvfile_nodir   { .entry = xnvfile_noentry }</span>
<a name="l00602"></a>00602 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_nolink  { .entry = xnvfile_noentry }</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_nofile  { .entry = xnvfile_noentry }</span>
<a name="l00604"></a>00604 <span class="preprocessor"></span>
<a name="l00605"></a>00605 <span class="preprocessor">#define xnvfile_parent(e)               ((e)-&gt;entry.parent)</span>
<a name="l00606"></a>00606 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_priv(e)                 ((e)-&gt;entry.private)</span>
<a name="l00607"></a>00607 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_nref(e)                 ((e)-&gt;entry.refcnt)</span>
<a name="l00608"></a>00608 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_file(e)                 ((e)-&gt;entry.file)</span>
<a name="l00609"></a>00609 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_iterator_priv(it)       ((void *)(&amp;(it)-&gt;private))</span>
<a name="l00610"></a>00610 <span class="preprocessor"></span>
<a name="l00611"></a>00611 <span class="keyword">extern</span> <span class="keyword">struct </span>xnvfile_nklock_class xnvfile_nucleus_lock;
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="keyword">extern</span> <span class="keyword">struct </span>xnvfile_directory <a class="code" href="group__vfile.html#ga7f46f9d1249c5d855b5ead672a0d6ee5" title="Xenomai vfile root directory.">nkvfroot</a>;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 <span class="keywordtype">int</span> xnvfile_init_root(<span class="keywordtype">void</span>);
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="keywordtype">void</span> xnvfile_destroy_root(<span class="keywordtype">void</span>);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00620"></a>00620 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00621"></a>00621 <span class="preprocessor">#endif</span>
<a name="l00622"></a>00622 <span class="preprocessor"></span>
<a name="l00623"></a>00623 <span class="keywordtype">int</span> <a class="code" href="group__vfile.html#gaad513ffc19d0ab33ff1722899841a442" title="Initialize a snapshot-driven vfile.">xnvfile_init_snapshot</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00624"></a>00624                           <span class="keyword">struct</span> <a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> *vfile,
<a name="l00625"></a>00625                           <span class="keyword">struct</span> xnvfile_directory *parent);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627 <span class="keywordtype">int</span> <a class="code" href="group__vfile.html#ga82b37f521d867ab9a94b15570210f83f" title="Initialize a regular vfile.">xnvfile_init_regular</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00628"></a>00628                          <span class="keyword">struct</span> xnvfile_regular *vfile,
<a name="l00629"></a>00629                          <span class="keyword">struct</span> xnvfile_directory *parent);
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 <span class="keywordtype">int</span> <a class="code" href="group__vfile.html#gadafe22257ce52d6e35698f4f66bb93c7" title="Initialize a virtual directory entry.">xnvfile_init_dir</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00632"></a>00632                      <span class="keyword">struct</span> xnvfile_directory *vdir,
<a name="l00633"></a>00633                      <span class="keyword">struct</span> xnvfile_directory *parent);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 <span class="keywordtype">int</span> <a class="code" href="group__vfile.html#ga3f28290884ca3c4458ac67e2b1845502" title="Initialize a virtual link entry.">xnvfile_init_link</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *from,
<a name="l00636"></a>00636                       <span class="keyword">const</span> <span class="keywordtype">char</span> *to,
<a name="l00637"></a>00637                       <span class="keyword">struct</span> xnvfile_link *vlink,
<a name="l00638"></a>00638                       <span class="keyword">struct</span> xnvfile_directory *parent);
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 <span class="keywordtype">void</span> <a class="code" href="group__vfile.html#ga5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(<span class="keyword">struct</span> xnvfile *vfile);
<a name="l00641"></a>00641 
<a name="l00642"></a>00642 ssize_t <a class="code" href="group__vfile.html#ga6a9005ee997d929f7c8940cfcfcab171" title="Read in a data bulk written to the vfile.">xnvfile_get_blob</a>(<span class="keyword">struct</span> xnvfile_input *input,
<a name="l00643"></a>00643                          <span class="keywordtype">void</span> *data, <span class="keywordtype">size_t</span> size);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645 ssize_t <a class="code" href="group__vfile.html#gae45ea5410707367c9e032dc36fc30916" title="Read in a C-string written to the vfile.">xnvfile_get_string</a>(<span class="keyword">struct</span> xnvfile_input *input,
<a name="l00646"></a>00646                            <span class="keywordtype">char</span> *s, <span class="keywordtype">size_t</span> maxlen);
<a name="l00647"></a>00647 
<a name="l00648"></a>00648 ssize_t <a class="code" href="group__vfile.html#ga18746b2aae928c0281ae57ef47086600" title="Evaluate the string written to the vfile as a long integer.">xnvfile_get_integer</a>(<span class="keyword">struct</span> xnvfile_input *input, <span class="keywordtype">long</span> *valp);
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 <span class="keywordtype">int</span> __vfile_hostlock_get(<span class="keyword">struct</span> xnvfile *vfile);
<a name="l00651"></a>00651 
<a name="l00652"></a>00652 <span class="keywordtype">void</span> __vfile_hostlock_put(<span class="keyword">struct</span> xnvfile *vfile);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00655"></a>00655 <span class="preprocessor"></span>}
<a name="l00656"></a>00656 <span class="preprocessor">#endif</span>
<a name="l00657"></a>00657 <span class="preprocessor"></span>
<a name="l00658"></a>00658 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00659"></a>00659 <span class="keywordtype">void</span> xnvfile_destroy_snapshot(<span class="keyword">struct</span> <a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> *vfile)
<a name="l00660"></a>00660 {
<a name="l00661"></a>00661         <a class="code" href="group__vfile.html#ga5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(&amp;vfile-&gt;entry);
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00665"></a>00665 <span class="keywordtype">void</span> xnvfile_destroy_regular(<span class="keyword">struct</span> xnvfile_regular *vfile)
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667         <a class="code" href="group__vfile.html#ga5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(&amp;vfile-&gt;entry);
<a name="l00668"></a>00668 }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00671"></a>00671 <span class="keywordtype">void</span> xnvfile_destroy_dir(<span class="keyword">struct</span> xnvfile_directory *vdir)
<a name="l00672"></a>00672 {
<a name="l00673"></a>00673         <a class="code" href="group__vfile.html#ga5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(&amp;vdir-&gt;entry);
<a name="l00674"></a>00674 }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00677"></a>00677 <span class="keywordtype">void</span> xnvfile_destroy_link(<span class="keyword">struct</span> xnvfile_link *vlink)
<a name="l00678"></a>00678 {
<a name="l00679"></a>00679         <a class="code" href="group__vfile.html#ga5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(&amp;vlink-&gt;entry);
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="preprocessor">#define DEFINE_VFILE_HOSTLOCK(name)                                     \</span>
<a name="l00683"></a>00683 <span class="preprocessor">        struct xnvfile_hostlock_class name = {                          \</span>
<a name="l00684"></a>00684 <span class="preprocessor">                .ops = {                                                \</span>
<a name="l00685"></a>00685 <span class="preprocessor">                        .get = __vfile_hostlock_get,                    \</span>
<a name="l00686"></a>00686 <span class="preprocessor">                        .put = __vfile_hostlock_put,                    \</span>
<a name="l00687"></a>00687 <span class="preprocessor">                },                                                      \</span>
<a name="l00688"></a>00688 <span class="preprocessor">                .sem = __SEMAPHORE_INITIALIZER(name.sem, 1),            \</span>
<a name="l00689"></a>00689 <span class="preprocessor">        }</span>
<a name="l00690"></a>00690 <span class="preprocessor"></span>
<a name="l00691"></a>00691 <span class="preprocessor">#else </span><span class="comment">/* !CONFIG_XENO_OPT_VFILE */</span>
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 <span class="preprocessor">#define xnvfile_touch_tag(tag)  do { } while (0)</span>
<a name="l00694"></a>00694 <span class="preprocessor"></span>
<a name="l00695"></a>00695 <span class="preprocessor">#define xnvfile_touch(vfile)    do { } while (0)</span>
<a name="l00696"></a>00696 <span class="preprocessor"></span>
<a name="l00697"></a>00697 <span class="preprocessor">#endif </span><span class="comment">/* !CONFIG_XENO_OPT_VFILE */</span>
<a name="l00698"></a>00698 
<a name="l00701"></a>00701 <span class="preprocessor">#endif </span><span class="comment">/* !_XENO_NUCLEUS_VFILE_H */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Jul 10 2012 20:41:22 for Xenomai API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
